{% extends "base.html" %}

{% block title %}Support the Library — {{ library_name_latin }}{% endblock %}

{% block content %}
<div class="donate-page">

  {# ── Hero Banner ─────────────────────────────────────────────── #}
  <div class="donate-hero-banner">
    <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Library seal" class="donate-hero-seal">
    <h1 class="donate-hero-title">Support Our Library</h1>
    <p class="donate-hero-tagline">
      Every volume exists because someone believed it was worth preserving.
    </p>
    <div class="donate-hero-body">
      <p>
        The Oratory's collection&mdash;patristic commentaries, manuals of
        ascetical theology, children's catechisms, rare pre-conciliar
        texts&mdash;has been assembled and digitised through the quiet,
        patient work of a small community. We keep it open and free for
        every member of the faithful, and we intend to keep it that way.
      </p>
      <p>
        But a library does not sustain itself. If these books have nourished
        your prayer, study, or teaching, we humbly ask: would you help us
        continue this work?
      </p>
    </div>
    <div class="donate-hero-ornament" aria-hidden="true">&#x2726;</div>
  </div>

  {# ── Give Online ─────────────────────────────────────────────── #}
  {% if has_digital_donations %}
  <section class="donate-section">
    <h2 class="donate-section-title">Give Online</h2>
    <div class="donate-method-grid">

      {% if donate_paypal_url %}
      <div class="donate-method-card donate-method-card--featured">
        <div class="donate-method-label">Recommended</div>
        <h3 class="donate-method-title">PayPal</h3>
        <p class="donate-method-desc">
          A financial gift of any size goes directly toward acquiring new
          titles, digitising physical volumes, and keeping our servers running.
        </p>
        <a href="{{ donate_paypal_url }}" class="donate-paypal-btn" rel="noopener noreferrer" target="_blank">
          Donate via PayPal
        </a>
      </div>
      {% endif %}

      {% if donate_zelle_address %}
      <div class="donate-method-card">
        <h3 class="donate-method-title">Zelle</h3>
        <p class="donate-method-desc">
          Send directly from your bank app&mdash;no fees, instant transfer.
        </p>
        <div class="donate-address-block">
          <span class="donate-address-value" id="zelle-addr">{{ donate_zelle_address }}</span>
          <button type="button" class="donate-copy-btn" data-copy-target="zelle-addr">Copy</button>
        </div>
      </div>
      {% endif %}

    </div>
  </section>
  {% endif %}

  {# ── Cryptocurrency ──────────────────────────────────────────── #}
  {% if has_crypto_donations %}
  <section class="donate-section">
    <h2 class="donate-section-title">Cryptocurrency</h2>
    <div class="donate-method-grid">

      {% if donate_btc_address %}
      <div class="donate-method-card">
        <h3 class="donate-method-title">Bitcoin (BTC)</h3>
        <div class="donate-crypto-body">
          <div class="donate-qr" data-qr-value="bitcoin:{{ donate_btc_address }}"></div>
          <div class="donate-crypto-info">
            <div class="donate-address-block">
              <span class="donate-address-value donate-address-value--mono" id="btc-addr">{{ donate_btc_address }}</span>
              <button type="button" class="donate-copy-btn" data-copy-target="btc-addr">Copy</button>
            </div>
          </div>
        </div>
      </div>
      {% endif %}

      {% if donate_eth_address %}
      <div class="donate-method-card">
        <h3 class="donate-method-title">Ethereum (ETH)</h3>
        <div class="donate-crypto-body">
          <div class="donate-qr" data-qr-value="ethereum:{{ donate_eth_address }}"></div>
          <div class="donate-crypto-info">
            <div class="donate-address-block">
              <span class="donate-address-value donate-address-value--mono" id="eth-addr">{{ donate_eth_address }}</span>
              <button type="button" class="donate-copy-btn" data-copy-target="eth-addr">Copy</button>
            </div>
          </div>
        </div>
      </div>
      {% endif %}

      {% if donate_xmr_address %}
      <div class="donate-method-card">
        <h3 class="donate-method-title">Monero (XMR)</h3>
        <div class="donate-crypto-body">
          <div class="donate-qr" data-qr-value="monero:{{ donate_xmr_address }}"></div>
          <div class="donate-crypto-info">
            <div class="donate-address-block">
              <span class="donate-address-value donate-address-value--mono" id="xmr-addr">{{ donate_xmr_address }}</span>
              <button type="button" class="donate-copy-btn" data-copy-target="xmr-addr">Copy</button>
            </div>
          </div>
        </div>
      </div>
      {% endif %}

      {% if donate_ltc_address %}
      <div class="donate-method-card">
        <h3 class="donate-method-title">Litecoin (LTC)</h3>
        <div class="donate-crypto-body">
          <div class="donate-qr" data-qr-value="litecoin:{{ donate_ltc_address }}"></div>
          <div class="donate-crypto-info">
            <div class="donate-address-block">
              <span class="donate-address-value donate-address-value--mono" id="ltc-addr">{{ donate_ltc_address }}</span>
              <button type="button" class="donate-copy-btn" data-copy-target="ltc-addr">Copy</button>
            </div>
          </div>
        </div>
      </div>
      {% endif %}

    </div>
  </section>
  {% endif %}

  {# ── Donate a Book ───────────────────────────────────────────── #}
  {% if has_book_donations %}
  <section class="donate-section">
    <h2 class="donate-section-title">Donate a Book</h2>
    <div class="donate-method-grid">
      <div class="donate-method-card donate-method-card--full">
        <p class="donate-method-desc">
          If you possess Catholic works you would like to see preserved&mdash;theology,
          Sacred Scripture, spirituality, Church history, canon law, liturgy, or
          hagiography&mdash;we warmly welcome them. We are especially grateful for
          works with an imprimatur, editions of the Fathers, and titles our
          patrons have requested.
        </p>
        <p class="donate-method-desc" style="margin-top: -0.5rem;">
          Books in good condition may be mailed to:
        </p>
        <div class="donate-address-block">
          <span class="donate-address-value donate-address-value--multiline">{% for line in donate_mailing_lines %}{{ line }}{% if not loop.last %}
{% endif %}{% endfor %}</span>
        </div>
        <p class="donate-method-desc" style="margin-top: 1rem; font-size: 0.85rem; color: #5c534d;">
          Unsure whether a volume is a good fit? Write to
          <a href="mailto:{{ library_contact_email }}" style="color: #6b1d2a;">{{ library_contact_email }}</a>
          before sending.
        </p>
      </div>
    </div>
  </section>
  {% endif %}

  {# ── Where Your Gift Goes ────────────────────────────────────── #}
  <section class="donate-section">
    <h2 class="donate-section-title">Where Your Gift Goes</h2>
    <div class="donate-impact-grid">
      <div class="donate-impact-item">
        <span class="donate-impact-icon" aria-hidden="true">&#x1F4DA;</span>
        <div class="donate-impact-label">Acquiring</div>
        <div class="donate-impact-desc">Purchasing books requested by our patrons</div>
      </div>
      <div class="donate-impact-item">
        <span class="donate-impact-icon" aria-hidden="true">&#x1F4F7;</span>
        <div class="donate-impact-label">Digitisation</div>
        <div class="donate-impact-desc">Digitising and preserving rare Catholic texts</div>
      </div>
      <div class="donate-impact-item">
        <span class="donate-impact-icon" aria-hidden="true">&#x1F5A5;</span>
        <div class="donate-impact-label">Infrastructure</div>
        <div class="donate-impact-desc">Hosting and maintaining the digital lending system</div>
      </div>
      <div class="donate-impact-item">
        <span class="donate-impact-icon" aria-hidden="true">&#x1F310;</span>
        <div class="donate-impact-label">Public Access</div>
        <div class="donate-impact-desc">Expanding the public domain collection for free access</div>
      </div>
    </div>
  </section>

  {# ── Closing ─────────────────────────────────────────────────── #}
  <section class="donate-section">
    <div class="donate-prayer-card">
      <h3>Pray for Us</h3>
      <p>
        Above all, we ask for your prayers. The Oratory remembers its
        benefactors at every Mass and in our daily Office. A Hail Mary for
        the success of this apostolate is the greatest gift you can offer.
      </p>
    </div>

    <p class="donate-scripture">
      <em>&ldquo;Each one must give as he has decided in his heart, not
      reluctantly or under compulsion, for God loves a cheerful
      giver.&rdquo;</em><br>
      <span class="donate-citation">&mdash; 2 Corinthians 9:7</span>
    </p>

    <p class="donate-gratitude">
      May God reward your generosity and may the saints whose words fill
      these pages intercede for you and your families.
    </p>

    <div class="donate-closing-ornament" aria-hidden="true">&#x271D;</div>
  </section>

</div>
{% endblock %}

{% block scripts %}
{% if has_crypto_donations %}
<script src="{{ url_for('static', filename='vendor/qrcode-svg.min.js') }}" nonce="{{ csp_nonce }}"></script>
{% endif %}
<script nonce="{{ csp_nonce }}">
(function() {
  /* ── QR Code Generation ──────────────────────────────────────── */
  if (typeof QRCode !== 'undefined') {
    document.querySelectorAll('[data-qr-value]').forEach(function(el) {
      try {
        var qr = new QRCode({
          content: el.getAttribute('data-qr-value'),
          width: 120,
          height: 120,
          padding: 2,
          color: '#1a1412',
          background: '#ffffff',
          ecl: 'M',
          join: true
        });
        el.innerHTML = qr.svg({ container: 'svg-viewbox' });
      } catch (e) {
        el.style.display = 'none';
      }
    });
  }

  /* ── Copy to Clipboard ───────────────────────────────────────── */
  document.querySelectorAll('.donate-copy-btn').forEach(function(btn) {
    btn.addEventListener('click', function() {
      var targetId = btn.getAttribute('data-copy-target');
      var target = document.getElementById(targetId);
      if (!target) return;

      var text = target.textContent.trim();

      function onSuccess() {
        btn.textContent = 'Copied!';
        btn.classList.add('donate-copy-btn--copied');
        setTimeout(function() {
          btn.textContent = 'Copy';
          btn.classList.remove('donate-copy-btn--copied');
        }, 2000);
      }

      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(onSuccess).catch(function() {
          fallbackCopy(text, onSuccess);
        });
      } else {
        fallbackCopy(text, onSuccess);
      }
    });
  });

  function fallbackCopy(text, callback) {
    var textarea = document.createElement('textarea');
    textarea.value = text;
    textarea.style.position = 'fixed';
    textarea.style.opacity = '0';
    document.body.appendChild(textarea);
    textarea.select();
    try {
      document.execCommand('copy');
      callback();
    } catch (e) { /* silently fail */ }
    document.body.removeChild(textarea);
  }
})();
</script>
{% endblock %}
