<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{{ library_name_latin }}{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="icon" href="{{ url_for('static', filename='img/favicon.ico') }}" type="image/x-icon">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#4a1018">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='img/logo.png') }}">
    <link rel="search" type="application/opensearchdescription+xml" title="{{ library_name_latin }}" href="/opds/catalog.xml">
    {% block head_extra %}{% endblock %}
</head>
<body>
    <header class="site-header">
        <div class="header-inner container">
            <div class="header-branding">
                <a href="{{ url_for('catalog.index') }}" class="header-title-link">
                    <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Library crest" class="header-logo">
                    <div class="header-text">
                        <h1 class="header-title">{{ library_name_latin }}</h1>
                        <p class="header-subtitle">{{ library_name_english }}</p>
                    </div>
                </a>
            </div>
            <nav class="main-nav" aria-label="Main navigation">
                <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
                    <span class="nav-toggle-bar"></span>
                    <span class="nav-toggle-bar"></span>
                    <span class="nav-toggle-bar"></span>
                </button>
                <ul class="nav-list">
                    <li class="nav-item">
                        <a href="{{ url_for('catalog.browse') }}" class="nav-link">
                            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"/></svg>
                            Catalog
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{ url_for('collections.index') }}" class="nav-link">
                            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M6 6.878V6a2.25 2.25 0 012.25-2.25h7.5A2.25 2.25 0 0118 6v.878m-12 0c.235-.083.487-.128.75-.128h10.5c.263 0 .515.045.75.128m-12 0A2.25 2.25 0 003.75 9v.878m0 0c.235-.083.487-.128.75-.128h10.5c.263 0 .515.045.75.128M3.75 9.878A2.25 2.25 0 001.5 12v6a2.25 2.25 0 002.25 2.25h16.5A2.25 2.25 0 0022.5 18v-6a2.25 2.25 0 00-2.25-2.122"/></svg>
                            Collections
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{ url_for('catalog.donate') }}" class="nav-link">
                            <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z"/></svg>
                            Donate
                        </a>
                    </li>
                    {% if current_user.is_authenticated %}
                        {% if current_user.role == 'patron' %}
                        <li class="nav-item">
                            <a href="{{ url_for('patron.dashboard') }}" class="nav-link">
                                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"/></svg>
                                My Loans
                            </a>
                        </li>
                        {% endif %}
                        {% if current_user.is_admin or current_user.is_librarian %}
                        <li class="nav-item">
                            <a href="{{ url_for('admin.dashboard') }}" class="nav-link">
                                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"/><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                                Admin
                            </a>
                        </li>
                        {% endif %}
                        <li class="nav-item">
                            <form action="{{ url_for('auth.logout') }}" method="POST" style="display:inline; margin:0; padding:0; border:none; background:none;">
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                <button type="submit" class="nav-link nav-link--muted" style="background:none; border:none; cursor:pointer; font:inherit; padding:0.45rem 0.85rem;">Sign Out</button>
                            </form>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a href="{{ url_for('auth.login') }}" class="nav-link">Sign In</a>
                        </li>
                    {% endif %}
                </ul>
            </nav>
        </div>
    </header>

    <main class="main-content">
        <div class="container">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                <div class="flash-messages" role="alert">
                    {% for category, message in messages %}
                    <div class="flash flash--{{ category }}">
                        <span class="flash-text">{{ message }}</span>
                        <button class="flash-dismiss" aria-label="Dismiss">&times;</button>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            {% endwith %}

            {% block content %}{% endblock %}
        </div>
    </main>

    <footer class="site-footer">
        <div class="footer-inner container">
            <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Library crest" class="footer-logo">
            <p class="footer-name">{{ library_name_latin }}</p>
            <p class="footer-name-en">{{ library_name_english }}</p>
            <div class="footer-links">
                <a href="mailto:{{ library_contact_email }}">Contact</a>
                <span class="footer-sep" aria-hidden="true">&middot;</span>
                <a href="{{ url_for('catalog.policy') }}">Lending Policy</a>
                <span class="footer-sep" aria-hidden="true">&middot;</span>
                <a href="{{ url_for('catalog.donate') }}">Support the Library</a>
            </div>
            <p class="footer-verse"><em>"Dabo vobis cor novum"</em></p>
        </div>
    </footer>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var toggle = document.querySelector(".nav-toggle");
            var navList = document.querySelector(".nav-list");
            if (toggle && navList) {
                toggle.addEventListener("click", function () {
                    var expanded = toggle.getAttribute("aria-expanded") === "true";
                    toggle.setAttribute("aria-expanded", String(!expanded));
                    navList.classList.toggle("nav-list--open");
                });
            }
            document.querySelectorAll(".flash-dismiss").forEach(function (btn) {
                btn.addEventListener("click", function () {
                    var el = btn.parentElement;
                    el.style.opacity = "0";
                    el.style.transform = "translateY(-10px)";
                    setTimeout(function () { el.remove(); }, 300);
                });
            });

            // Register service worker for PWA support
            if ("serviceWorker" in navigator) {
                navigator.serviceWorker.register("/static/sw.js").catch(function () {});
            }
        });
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>
